/* 基础字体和布局 */
body {
    font-family: '微软雅黑', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
    box-sizing: border-box;
    /* 恢复到中性/初始背景色 */
    background-color: #f4f7f6;
    position: relative; 
}

.container {
    width: 100%;
    max-width: 1100px;
    margin: 0 auto;
    position: relative;
    z-index: 1; 
    padding: 20px;
    background: transparent; 
    border-radius: 15px;
}

h1 {
    font-family: '微软雅黑', sans-serif;
    text-align: left;
    margin-top: 0;
    /* 减小与下方消息区域的间距 */
    margin-bottom: 5px; 
    color: #2c3e50; /* 深色标题 */
    font-size: 3.5em;
    font-weight: 500;
}

/* 消息区域新样式：左对齐，占据整个容器宽度 */
.message-area {
    font-family: '微软雅黑', sans-serif; 
    font-size: 1.0em; /* 增大字体方便阅读 */
    color: #2a2a2a; 
    margin: 30px 0 30px 0; /* 调整上下边距，与 flow-diagram 分离 */
    min-height: 20px;
    text-align: left; /* 核心：左对齐 */
    width: 100%; /* 确保占据整个容器宽度 */
}

.flow-diagram {
    display: flex;
    flex-direction: row;
    justify-content: space-between;
    align-items: stretch; 
    width: 100%;
}
.step-container {
    text-align: center;
    width: 30%;
    display: flex;
    flex-direction: column;
}

/* 核心对齐调整 */
.step {
    border: 1px solid #eee; 
    padding: 20px;
    border-radius: 10px;
    flex-grow: 1; 
    display: flex;
    flex-direction: column;
    align-items: center;
    background: #ffffff; 
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    transition: box-shadow 0.3s ease;
    
    /* 核心修改：让内容上对齐，而不是居中 */
    justify-content: flex-start; 
}

.step-content-box {
    /* 红色框内容：包含解释/预览。占据可用空间以将底部框推到最下面 */
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    flex-grow: 1; 
    /* 确保内部内容上对齐，但预览图应垂直居中 */
    justify-content: flex-start; 
}

.step-bottom-box {
    /* 黄色框内容：包含按钮/选择框 */
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
    /* 核心修改：通过 margin-top: auto 自动将此块推到底部 */
    margin-top: auto; 
}

.step:hover {
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
}

.step-label {
    font-family: '微软雅黑', sans-serif;
    margin-top: 15px;
    font-weight: bold;
    font-size: 1.2em;
    color: #333; 
    text-shadow: none;
}

.arrow {
    font-size: 3em;
    font-weight: bold;
    color: #bbb;
    margin-top: 150px; 
    align-self: center; 
}

/* 图像框容器 - 保持垂直居中，但相对于 .step-content-box 上对齐 */
.image-box {
    width: 90%;
    min-height: 200px; 
    display: flex;
    justify-content: center;
    align-items: center;
    margin-bottom: 4px; 
    background: #f0f0f0; 
    border-radius: 8px;
    overflow: hidden;
}


/* 上传/生成/下载 按钮 - 确保大小一致 */
.custom-file-upload, .generate-button, .download-button {
    font-family: '微软雅黑', sans-serif;
    padding: 10px 20px;
    font-size: 1em;
    border-radius: 25px; 
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    font-weight: bold;
    margin: 6px 0; 
    border: none;
    
    /* 核心：统一按钮宽度 */
    width: 85%; 
    max-width: 200px; 
    box-sizing: border-box; 
    display: flex;
    justify-content: center;
}

.custom-file-upload {
    background-color: #007bff;
    color: white;
}
.custom-file-upload:hover {
    background-color: #0056b3;
}
#file-input {
    display: none;
}

/* 图像占位符 */
.image-placeholder-text {
    font-family: '微软雅黑', sans-serif;
    font-size: 1.1em;
    color: #999; 
    border: 2px dashed #ccc;
    width: 100%;
    height: 100%;
    box-sizing: border-box;
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0;
    padding: 0;
}

/* Canvas 样式 */
.image-preview-canvas {
    width: 100%;
    height: 100%; 
    max-height: 200px;
    box-sizing: border-box;
    object-fit: contain;
    margin: 0;
    display: none;
}

/* 扰动样本选择区域样式 */
.noise-selection-group {
    width: 100%;
    margin-top: 15px;
    text-align: center;
    /* 核心修改：使用 flex 布局让提示和选择框同行显示 */
    display: flex; 
    justify-content: center;
    align-items: center;
    /* 确保垂直对齐 */
    min-height: 40px; 
}

/* 新增：提示文本样式 */
.noise-select-prompt {
    font-family: '微软雅黑', sans-serif;
    font-size: 1em;
    color: #2c3e50; /* 更改为深黑，更清晰 */
    margin-right: 10px; /* 与下拉框保持间距 */
    font-weight: 500; /* 略微加粗 */
}

/* === 选择框样式优化开始 === */
#noise-type-select {
    font-family: '微软雅黑', sans-serif; 
    padding: 8px 15px;
    font-size: 1em;
    /* 更改边框和背景颜色，更简洁 */
    border: 1px solid #3498db; /* 柔和的蓝色边框 */
    border-radius: 47px; /* 略微圆角的矩形 */
    background-color: #ecf0f1; /* 浅灰色背景 */
    color: #2c3e50; /* 深色文字 */
    cursor: pointer;
    appearance: menulist; /* 使用更原生的下拉框外观 */
    outline: none; /* 移除点击时的默认边框 */
    /* 移除所有自定义箭头相关的背景样式 */
    background-image: none;
    background-repeat: no-repeat;
    background-position: initial;
    background-size: initial;
    padding-right: 15px; /* 恢复正常的右边距 */
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
    min-width: 120px;
}

#noise-type-select:hover {
    border-color: #2980b9; /* 悬停时颜色变深 */
}

#noise-type-select:focus {
    border-color: #2980b9;
    box-shadow: 0 0 5px rgba(52, 152, 219, 0.5); /* 聚焦时添加阴影 */
}
/* === 选择框样式优化结束 === */

/* 扰动样本显示框 */
.noise-display-box {
    width: 90%; /* 调整为90%以留出边距 */
    min-height: 100px;
    background-color: #222; 
    border-radius: 8px;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
    overflow: hidden;
    flex-grow: 1; /* 核心修改：占据解释框和选择框之间的所有空间 */
    flex-shrink: 0; 
    margin-top: 14px; /* 紧跟在解释框下面 */
    margin-bottom: 48px; /* 紧跟在解释框下面 */
}

#noise-canvas {
    display: block;  
    width: 100%;
    height: 100%; 
    position: absolute;  
    top: 0;
    left: 0;
    border-radius: 5px;  
}

.noise-text-overlay {
    display: none !important; 
}


/* 模型信息 (对抗样本解释) - 适用于第二步 */
#modelInfo {
    font-family: '微软雅黑', sans-serif;
    font-size: 0.9em;
    color: #333; 
    background-color: #f9f9f9; 
    padding: 6px;
    border: 1px dashed #bbb;
    border-radius: 5px;
    margin-top: 4px;
    margin-bottom: 0; /* 移除底部间距，让它更贴近 noise-display-box */
    text-align: left;
    width: 90%; /* 保持与 noise-display-box 对齐 */
    box-sizing: border-box;
    flex-shrink: 0; 
    order: -1; /* 将其放置在第二步 content-box 的最上方 */
}

/* 新增：生成对抗样本解释框样式 - 适用于第三步 */
.model-info-output {
    font-family: '微软雅黑', sans-serif;
    font-size: 0.9em;
    color: #333; 
    background-color: #f9f9f9; 
    padding: 6px;
    border: 1px dashed #bbb;
    border-radius: 5px;
    margin-top: 4px;
    margin-bottom: 14px; /* 调整间距以保持美观 */
    text-align: left;
    width: 90%; /* 保持与 image-box 对齐 */
    box-sizing: border-box;
    flex-shrink: 0; 
    order: -1; /* 将其放置在第三步 content-box 的最上方 */
}

/* 新增：生成按钮样式 */
.generate-button {
    background-color: #f39c12; 
    color: white;
    order: 1; 
}
.generate-button:not(.disabled):hover {
    background-color: #e67e22;
}
.generate-button.disabled {
    cursor: not-allowed;
    opacity: 0.5;
}

/* 下载按钮 */
.download-button {
    background-color: #48bb78; 
    color: white;
    order: 2; 
    cursor: not-allowed;
    opacity: 0.6;
}
.download-button.active {
    background-color: #48bb78;
    cursor: pointer;
    opacity: 1;
}
.download-button.active:hover {
    background-color: #38a169;
}


/* 响应式 */
@media (max-width: 768px) {
    .flow-diagram {
        flex-direction: column;
        align-items: center;
    }
    .step-container {
        width: 90%;
        margin-bottom: 10px;
    }
    .arrow {
        transform: rotate(90deg);
        margin: 15px 0;
    }
    /* 在小屏幕上，按钮可以有更灵活的宽度 */
    .custom-file-upload, .generate-button, .download-button {
        width: 100%;
        max-width: none; 
    }
}